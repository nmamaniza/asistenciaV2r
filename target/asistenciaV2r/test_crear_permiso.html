<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Crear Permiso</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: inline-block; width: 150px; }
        input, select { width: 200px; padding: 5px; }
        button { padding: 10px 20px; margin: 5px; }
        .result { margin-top: 20px; padding: 10px; border: 1px solid #ccc; background: #f9f9f9; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Test Crear Permiso</h1>
    <form id="testForm">
        <div class="form-group">
            <label>User ID:</label>
            <input type="number" id="userId" value="1" required>
        </div>
        <div class="form-group">
            <label>Permission Type:</label>
            <input type="text" id="permissionType" value="VACACIONES" required>
        </div>
        <div class="form-group">
            <label>Fecha Inicio:</label>
            <input type="date" id="fechaini" value="2024-01-01" required>
        </div>
        <div class="form-group">
            <label>Fecha Fin (opcional):</label>
            <input type="date" id="fechafin" value="2024-01-31">
        </div>
        <div class="form-group">
            <label>Job Assignment ID (opcional):</label>
            <input type="number" id="jobassignmentId">
        </div>
        <button type="submit">Crear Permiso</button>
        <button type="button" onclick="testConnection()">Test Connection</button>
    </form>
    
    <div id="result" class="result" style="display:none;"></div>

    <script>
        function testConnection() {
            fetch('/asistenciaV2r/api/permission-types', { credentials: 'include' })
                .then(r => r.json())
                .then(data => {
                    document.getElementById('result').style.display = 'block';
                    document.getElementById('result').innerHTML = '<h3>Connection Test:</h3><p class="success">✓ Connection successful</p><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                })
                .catch(error => {
                    document.getElementById('result').style.display = 'block';
                    document.getElementById('result').innerHTML = '<h3>Connection Test:</h3><p class="error">✗ Connection failed: ' + error.message + '</p>';
                });
        }

        document.getElementById('testForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new URLSearchParams();
            formData.append('userId', document.getElementById('userId').value);
            formData.append('permissionType', document.getElementById('permissionType').value);
            formData.append('fechaini', document.getElementById('fechaini').value);
            
            const fechafin = document.getElementById('fechafin').value;
            if (fechafin) formData.append('fechafin', fechafin);
            
            const jobId = document.getElementById('jobassignmentId').value;
            if (jobId) formData.append('jobassignmentId', jobId);
            
            document.getElementById('result').innerHTML = '<p>Enviando solicitud...</p>';
            document.getElementById('result').style.display = 'block';
            
            fetch('/asistenciaV2r/api/permissions', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: formData.toString(),
                credentials: 'include'
            })
            .then(r => {
                const ct = r.headers.get('content-type') || '';
                if (!r.ok || ct.indexOf('application/json') === -1) {
                    return r.text().then(t => { 
                        throw new Error('Respuesta no JSON (' + r.status + '): ' + t.slice(0,500)); 
                    });
                }
                return r.json();
            })
            .then(data => {
                document.getElementById('result').innerHTML = '<h3>Resultado:</h3><pre class="success">' + JSON.stringify(data, null, 2) + '</pre>';
            })
            .catch(error => {
                document.getElementById('result').innerHTML = '<h3>Error:</h3><p class="error">' + error.message + '</p>';
            });
        });
    </script>
</body>
</html>